<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 AMR data analysis | Data Wrangling and Analysis with R</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 AMR data analysis | Data Wrangling and Analysis with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 AMR data analysis | Data Wrangling and Analysis with R" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Centre for Epidemiological Modelling and Analysis" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-visualisation.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#what-can-r-do"><i class="fa fa-check"></i><b>1.2</b> What can R do?</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#basics-of-r"><i class="fa fa-check"></i><b>1.3</b> Basics of R</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#the-r-console"><i class="fa fa-check"></i><b>1.4</b> The <strong>R</strong> console</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#r-workspaces"><i class="fa fa-check"></i><b>1.5</b> R workspaces</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#useful-tips-for-r"><i class="fa fa-check"></i><b>1.6</b> Useful tips for <strong>R</strong></a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#r-resources-and-finding-help"><i class="fa fa-check"></i><b>1.7</b> <strong>R</strong> resources and finding help</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#r-architecture"><i class="fa fa-check"></i><b>1.8</b> <strong>R</strong> architecture</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>2</b> Getting started with R</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#installing-and-using-r-packages"><i class="fa fa-check"></i><b>2.1</b> Installing and using <strong>R</strong> packages</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#creating-objects-in-r"><i class="fa fa-check"></i><b>2.2</b> Creating objects in <strong>R</strong></a></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#functions-in-r"><i class="fa fa-check"></i><b>2.3</b> Functions in <strong>R</strong></a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#data-types-and-importation"><i class="fa fa-check"></i><b>2.4</b> Data types and importation</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#importing-and-data-manipulation-in-r"><i class="fa fa-check"></i><b>2.5</b> Importing and Data manipulation in R</a><ul>
<li class="chapter" data-level="2.5.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#in-built-datasets"><i class="fa fa-check"></i><b>2.5.1</b> In-built datasets</a></li>
<li class="chapter" data-level="2.5.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#import-data-from-external-files"><i class="fa fa-check"></i><b>2.5.2</b> Import data from ``external" files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-in-r.html"><a href="data-manipulation-in-r.html"><i class="fa fa-check"></i><b>3</b> Data Manipulation in R</a><ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-in-r.html"><a href="data-manipulation-in-r.html#dereferencing"><i class="fa fa-check"></i><b>3.1</b> Dereferencing</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-manipulation-in-r.html"><a href="data-manipulation-in-r.html#merging-data"><i class="fa fa-check"></i><b>3.1.1</b> Merging data</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-manipulation-in-r.html"><a href="data-manipulation-in-r.html#subsetting-data"><i class="fa fa-check"></i><b>3.1.2</b> Subsetting data</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-manipulation-in-r.html"><a href="data-manipulation-in-r.html#substring"><i class="fa fa-check"></i><b>3.1.3</b> Substring</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-wrangling.html"><a href="data-wrangling.html"><i class="fa fa-check"></i><b>4</b> Data wrangling</a><ul>
<li class="chapter" data-level="4.1" data-path="data-wrangling.html"><a href="data-wrangling.html#tools-for-manipulating-data"><i class="fa fa-check"></i><b>4.1</b> Tools for manipulating data</a></li>
<li class="chapter" data-level="4.2" data-path="data-wrangling.html"><a href="data-wrangling.html#making-datasets-tidy"><i class="fa fa-check"></i><b>4.2</b> Making datasets tidy</a></li>
<li class="chapter" data-level="4.3" data-path="data-wrangling.html"><a href="data-wrangling.html#pipes-in-r"><i class="fa fa-check"></i><b>4.3</b> Pipes in R %&gt;%</a></li>
<li class="chapter" data-level="4.4" data-path="data-wrangling.html"><a href="data-wrangling.html#gather"><i class="fa fa-check"></i><b>4.4</b> gather()</a></li>
<li class="chapter" data-level="4.5" data-path="data-wrangling.html"><a href="data-wrangling.html#grouping-data"><i class="fa fa-check"></i><b>4.5</b> Grouping data</a></li>
<li class="chapter" data-level="4.6" data-path="data-wrangling.html"><a href="data-wrangling.html#separate"><i class="fa fa-check"></i><b>4.6</b> separate()</a></li>
<li class="chapter" data-level="4.7" data-path="data-wrangling.html"><a href="data-wrangling.html#a-sample-data-set"><i class="fa fa-check"></i><b>4.7</b> A sample data set</a></li>
<li class="chapter" data-level="4.8" data-path="data-wrangling.html"><a href="data-wrangling.html#summarise"><i class="fa fa-check"></i><b>4.8</b> summarise()</a></li>
<li class="chapter" data-level="4.9" data-path="data-wrangling.html"><a href="data-wrangling.html#filter-rowsobservations-with-matching-conditions"><i class="fa fa-check"></i><b>4.9</b> filter() rows/observations with matching conditions</a></li>
<li class="chapter" data-level="4.10" data-path="data-wrangling.html"><a href="data-wrangling.html#distinct"><i class="fa fa-check"></i><b>4.10</b> distinct()</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-visualisation.html"><a href="data-visualisation.html"><i class="fa fa-check"></i><b>5</b> Data visualisation</a><ul>
<li class="chapter" data-level="5.1" data-path="data-visualisation.html"><a href="data-visualisation.html#starting-with-ggplot"><i class="fa fa-check"></i><b>5.1</b> Starting with ggplot</a><ul>
<li class="chapter" data-level="5.1.1" data-path="data-visualisation.html"><a href="data-visualisation.html#geom_bar"><i class="fa fa-check"></i><b>5.1.1</b> geom_bar</a></li>
<li class="chapter" data-level="5.1.2" data-path="data-visualisation.html"><a href="data-visualisation.html#geom_histogram"><i class="fa fa-check"></i><b>5.1.2</b> geom_histogram</a></li>
<li class="chapter" data-level="5.1.3" data-path="data-visualisation.html"><a href="data-visualisation.html#geom_boxplots"><i class="fa fa-check"></i><b>5.1.3</b> geom_boxplots</a></li>
<li class="chapter" data-level="5.1.4" data-path="data-visualisation.html"><a href="data-visualisation.html#facetwrap-using-two-variables"><i class="fa fa-check"></i><b>5.1.4</b> Facetwrap using two variables</a></li>
<li class="chapter" data-level="5.1.5" data-path="data-visualisation.html"><a href="data-visualisation.html#using-histogram-and-faceting"><i class="fa fa-check"></i><b>5.1.5</b> using histogram and faceting</a></li>
<li class="chapter" data-level="5.1.6" data-path="data-visualisation.html"><a href="data-visualisation.html#using-density"><i class="fa fa-check"></i><b>5.1.6</b> using density</a></li>
<li class="chapter" data-level="5.1.7" data-path="data-visualisation.html"><a href="data-visualisation.html#geom_point-using-the-iris-dataset"><i class="fa fa-check"></i><b>5.1.7</b> geom_point using the iris dataset</a></li>
<li class="chapter" data-level="5.1.8" data-path="data-visualisation.html"><a href="data-visualisation.html#using-more-aesthetics-in-geom_point"><i class="fa fa-check"></i><b>5.1.8</b> Using more aesthetics in geom_point</a></li>
<li class="chapter" data-level="5.1.9" data-path="data-visualisation.html"><a href="data-visualisation.html#using-statistics-with-ggplot"><i class="fa fa-check"></i><b>5.1.9</b> Using statistics with ggplot</a></li>
<li class="chapter" data-level="5.1.10" data-path="data-visualisation.html"><a href="data-visualisation.html#working-with-themes"><i class="fa fa-check"></i><b>5.1.10</b> Working with themes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html"><i class="fa fa-check"></i><b>6</b> AMR data analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#human-health-sector-amr-data"><i class="fa fa-check"></i><b>6.1</b> Human Health Sector AMR data</a></li>
<li class="chapter" data-level="6.2" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#human-health-sector-amuc-data"><i class="fa fa-check"></i><b>6.2</b> Human Health Sector AMU/C data</a><ul>
<li class="chapter" data-level="6.2.1" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#first-isolates"><i class="fa fa-check"></i><b>6.2.1</b> First isolates</a></li>
<li class="chapter" data-level="6.2.2" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#resistance-percentages"><i class="fa fa-check"></i><b>6.2.2</b> Resistance percentages</a></li>
<li class="chapter" data-level="6.2.3" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#independence-test"><i class="fa fa-check"></i><b>6.2.3</b> Independence test</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="amr-data-analysis.html"><a href="amr-data-analysis.html#animal-health-sector-amuc-data"><i class="fa fa-check"></i><b>6.3</b> Animal Health Sector AMU/C data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Wrangling and Analysis with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="amr-data-analysis" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> AMR data analysis</h1>
<ul>
<li><p>Antimicrobial Resistance is one of the top ten global health threats.</p></li>
<li><p>The animal health and human health sector should present AMR surveillance reports to the National Antimicrobial Stewardship Interagency Committee (NASIC)</p></li>
<li><p>The flow of AMR data is summarised below.</p></li>
</ul>
<div class="figure">
<img src="images/data_flow1.png" alt="" />
<p class="caption">Sources and flow of AMR data</p>
</div>
<ul>
<li><p>To carry our analysis of AMR data, we will use the <strong>AMR package</strong>.</p></li>
<li><p>The <strong>AMR package</strong> is a free open-source package for analysis and prediction of AMR and can be used for antimicrobial resistance data analysis. It contains the complete taxonomic tree of almost all microorganisms, antibiotics, antimycotic and antiviral drugs.</p></li>
<li><p>The package can be used for:</p>
<ul>
<li>Referencing the taxonomy of microorganisms</li>
<li>Interpreting raw MIC and disk diffusion values based on the latest CLSI or EUCAST guidelines</li>
<li>Retrieving antimicrobial drug names, doses and forms of administration from clinical health care records</li>
<li>Determining first isolates to be used for AMR analysis</li>
<li>Calculating antimicrobial resistance</li>
<li>Determining multi-drug resistance or multi-drug resistance organisms etc</li>
</ul></li>
<li><p>The package comes with four fundamental tools:</p>
<ol style="list-style-type: decimal">
<li><strong>Data wrangling prerequisites for microbiology data</strong>: these are enabled through the functions specific for microorganisms, antibiotics and antimicrobial results:</li>
</ol>
<ul>
<li><strong>as.mo():</strong> Used to get a microbial ID using algorithms that match almost similar names into a human readable format e.g the ID of <em>Klebsiella pneumoniae</em> is “B_KLBSL_PNMN” where B stands for Bacteria. Furthermore, it is able to group <em>Staphylococci</em> into coagulase positive and negative, <em>streptococci</em> into Lancefield groups</li>
<li><strong>as.ab():</strong> Used to get an antibiotic IDusing a process similar to as.mo() above. e.g, the ID of gentamicin is <strong>GEN</strong>.</li>
<li><strong>as.rsi():</strong> Used to get antibiotic interpretations based on raw MIC values (in mg/L) or disk diffusion values (in mm). Based on your input, it produces the values as S (Susceptible), I (Intermediate) or R (Resistant)while also warning you about invalid values. E.g based on the MIC cut off, &lt;=0.001 will result in S. It does so using either the CLSI or the EUCAST guideline. You can specify the guideline of choice. Currently, it supports CLSI2010:CLSI2019 and EUCAST2011:EUCAST2020</li>
<li><strong>as.mic():</strong> Used to clean the MIC values into the acceptable format. e.g., “&lt;=0.002;S” will be converted to “&lt;=0.002”</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Enhances existing data and adds new data from inbuilt datasets from this package</li>
</ol>
<ul>
<li><strong>eucast_rules:</strong> used to apply EUCAST expert rules to isolates which are graded into three (A, B, C) where: A- there is good clinical evidence for the rule hence applying it has a likelihood of improving the patient care; B- evidence is weak or based on few case reports or experimental data; C- there is no clinical evidence but vitro microbiological data suggests application of the rule</li>
<li><strong>first_isolate:</strong> used to identify the first isolate of every patient using the CLSI guidelines. Similarly, you can identify first weighted isolates for every patient which takes into account key antibiotics of every strain and compares them</li>
<li><strong>mdro():</strong> For determining the micro-organisms that are multi-drus resistant organisms (MDRO)</li>
<li>Functions which enable looking up values from the microorganisms dataset. They include: <strong>mo_gramstain()</strong>, <strong>mo_genus</strong>, <strong>mo_family</strong>, <strong>mo_phylum</strong> etc. e.g., <strong>mo_genus("MRSA)</strong> will return <em>Staphylococcus</em>.</li>
<li>Functions which enable looking up values from the antibiotics dataset. They include: <strong>ab_atc()</strong>, <strong>ab_loinc</strong>, <strong>ab_tradenames</strong>. To find out more about how each works, you can use the R inbuilt help function by just adding a question mark infront of the function name e.g., ?ab_atc().</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Analyses data using convenient functions:</li>
</ol>
<ul>
<li>You can calculate microbial susceptibility or resistance and co-resistance with the <strong>susceptibility()</strong> and <strong>resistance()</strong> functions or with <strong>proportion_R()</strong>, <strong>proportion_IR()</strong>, <strong>proportion_I()</strong>, <strong>proportion_SI</strong>, <strong>proportion_S</strong> functions. In addition, the number of isolates can be determined using the following functions: <strong>count_resistance()</strong>, <strong>count_susceptible()</strong> and <strong>count_count_all()</strong>.</li>
<li>One can plot AMR results with <strong>geom_rsi()</strong> function which is made from the ggplot2 package</li>
<li>You can predict antimicrobial resistance for the next years using logistic regression models with the <strong>resistance_predict()</strong> function</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>This package has inbuilt datasets and examples on all the functions to enable the user learn how to use the above actions</li>
</ol>
<ul>
<li>The package contains example datasets, like the one we will be using in this tutorial</li>
<li>It also contains a WHONET dataset with a similar structure as the files exported by WHONET.</li>
</ul></li>
<li><p>We will learn how to conduct AMR data analysis in the following sections (animal health and human health) using this package.</p></li>
</ul>
<div id="human-health-sector-amr-data" class="section level2">
<h2><span class="header-section-number">6.1</span> Human Health Sector AMR data</h2>
<ul>
<li><p>This data is mainly collected through the WHONET collection tool</p></li>
<li><p>To understand how data from the WHONET tool is analysed and reported, we will use the inbuilt dataset from the <strong>AMR package</strong> which contains 500 isolates and 53 variables. To access the data, you can type the following codes in your console:</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="amr-data-analysis.html#cb1-1"></a><span class="kw">library</span>(tidyverse) <span class="co"># import the tidyverse packages</span></span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.3     ✓ purrr   0.3.4
## ✓ tibble  3.1.0     ✓ dplyr   1.0.5
## ✓ tidyr   1.1.3     ✓ stringr 1.4.0
## ✓ readr   1.4.0     ✓ forcats 0.5.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="amr-data-analysis.html#cb5-1"></a><span class="kw">library</span>(AMR) <span class="co"># import the AMR package in your global environment</span></span>
<span id="cb5-2"><a href="amr-data-analysis.html#cb5-2"></a><span class="kw">library</span>(cleaner) <span class="co"># import the cleaning package</span></span></code></pre></div>
<ul>
<li><p>To learn more about the dataset, enter <em>?WHONET</em> on your console.</p></li>
<li><p>We will now transform the microorganism IDs using the most comprehensive global index of species currently available. The catalogue can be accessed <a href="https://www.catalogueoflife.org/">here</a>. We will do the transformation using the <strong>as.mo()</strong> function.</p></li>
<li><p>Similarly, we can interpret the MIC values using the CLSI 2019 guideline</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="amr-data-analysis.html#cb6-1"></a>WHONET_dataset&lt;-<span class="st"> </span>WHONET<span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="amr-data-analysis.html#cb6-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">mo=</span><span class="kw">as.mo</span>(Organism))<span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="amr-data-analysis.html#cb6-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(AMP_ND10<span class="op">:</span>CIP_EE), <span class="kw">funs</span>(<span class="kw">as.rsi</span>(.,<span class="dt">guideline=</span><span class="st">&quot;CLSI2019&quot;</span>)))</span></code></pre></div>
<pre><code>## Warning: `funs()` was deprecated in dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</code></pre>
<ul>
<li>To create the frequency tables, we can use the <strong>freq()</strong> function from the <strong>cleaner</strong> package</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="amr-data-analysis.html#cb8-1"></a>WHONET_dataset <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">freq</span>(<span class="kw">mo_name</span>(mo), <span class="dt">nmax =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## 
## 
## **Frequency table**   
## 
## Class:      character  
## Length:     500  
## Available:  500 (100%, NA: 0 = 0%)  
## Unique:     37  
##   
## Shortest:   11  
## Longest:    40
## 
## 
## |   |Item                                     | Count| Percent| Cum. Count| Cum. Percent|
## |:--|:----------------------------------------|-----:|-------:|----------:|------------:|
## |1  |Escherichia coli                         |   245|   49.0%|        245|        49.0%|
## |2  |Coagulase-negative Staphylococcus (CoNS) |    74|   14.8%|        319|        63.8%|
## |3  |Staphylococcus epidermidis               |    38|    7.6%|        357|        71.4%|
## |4  |Streptococcus pneumoniae                 |    31|    6.2%|        388|        77.6%|
## |5  |Staphylococcus hominis                   |    21|    4.2%|        409|        81.8%|
## |6  |Proteus mirabilis                        |     9|    1.8%|        418|        83.6%|
## |7  |Enterococcus faecium                     |     8|    1.6%|        426|        85.2%|
## |8  |Staphylococcus capitis                   |     8|    1.6%|        434|        86.8%|
## |9  |Enterobacter cloacae                     |     5|    1.0%|        439|        87.8%|
## |10 |Streptococcus anginosus                  |     5|    1.0%|        444|        88.8%|
## 
## (omitted 27 entries, n = 56 [11.20%])</code></pre>
<ul>
<li>A quick visualisation of the data can be observed using the <strong>ggplot_rsi()</strong> function which borrows alot from the <strong>ggplot2</strong> packages covered earlier in the tutorial</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="amr-data-analysis.html#cb10-1"></a>WHONET_dataset <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="amr-data-analysis.html#cb10-2"></a><span class="st">  </span><span class="kw">group_by</span>(Country) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># group the data by country</span></span>
<span id="cb10-3"><a href="amr-data-analysis.html#cb10-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Country, AMP_ND2, AMC_ED20, CAZ_ED10, CIP_ED5) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># select the required columns</span></span>
<span id="cb10-4"><a href="amr-data-analysis.html#cb10-4"></a><span class="st">  </span><span class="kw">ggplot_rsi</span>(<span class="dt">translate_ab =</span> <span class="st">&#39;ab&#39;</span>, <span class="dt">facet =</span> <span class="st">&quot;Country&quot;</span>, <span class="dt">datalabels =</span> <span class="ot">FALSE</span>)<span class="op">+</span><span class="st"> </span><span class="co"># translate the antibiotics to the known abbreviations</span></span>
<span id="cb10-5"><a href="amr-data-analysis.html#cb10-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="human-health-sector-amuc-data" class="section level2">
<h2><span class="header-section-number">6.2</span> Human Health Sector AMU/C data</h2>
<ul>
<li><p>This data is mainly collected using tools like RedCap, Commcare or ODK.</p></li>
<li><p>For this tutorial, we will use a sample dataset which contains 150 entries of blood culture isolates. We can use the <strong>read_csv</strong> function to read the data.</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="amr-data-analysis.html#cb11-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb11-2"><a href="amr-data-analysis.html#cb11-2"></a><span class="kw">library</span>(AMR) </span>
<span id="cb11-3"><a href="amr-data-analysis.html#cb11-3"></a><span class="kw">library</span>(cleaner)</span>
<span id="cb11-4"><a href="amr-data-analysis.html#cb11-4"></a>data&lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/ThumbiMwangi/R_sources/master/AMR_training_data_human.csv&quot;</span>)</span></code></pre></div>
<pre><code>## 
## ── Column specification ────────────────────────────────────────────────────────
## cols(
##   date = col_date(format = &quot;&quot;),
##   ID = col_character(),
##   gender = col_character(),
##   ward = col_character(),
##   Organism_Name = col_character(),
##   AMP = col_character(),
##   AMC = col_character(),
##   CIP = col_character(),
##   GEN = col_character()
## )</code></pre>
<ul>
<li>From the output, we can see that the columns contained in our dataset. To preview our data, we use the function <strong>head()</strong>.</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="amr-data-analysis.html#cb13-1"></a><span class="kw">head</span>(data)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   date       ID    gender ward  Organism_Name AMP   AMC   CIP   GEN  
##   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 2010-01-01 V142  M      A1    Esch.coli     &gt;=32  16    &gt;=4   &lt;=1  
## 2 2010-01-02 H89   F      A2    Esch.coli     &gt;=32  16    &gt;=4   &lt;=1  
## 3 2010-01-03 I98   F      A3    Esch.coli     &gt;=32  &gt;=32  &gt;=4   &lt;=1  
## 4 2010-01-04 N143  M      A4    Esch.coli     &gt;=32  16    &gt;=4   &gt;=16 
## 5 2010-01-05 F101  F      A5    Esch.coli     &gt;=32  &gt;=32  &gt;=4   &lt;=1  
## 6 2010-01-06 T78   F      A6    Esch.coli     &gt;=32  &gt;=32  &gt;=4   &lt;=1</code></pre>
<ul>
<li>We can create a frequency table using the <em>freq()</em> function from the cleaner package</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="amr-data-analysis.html#cb15-1"></a>data<span class="op">%&gt;%</span><span class="kw">freq</span>(gender)</span></code></pre></div>
<pre><code>## 
## 
## **Frequency table**   
## 
## Class:      character  
## Length:     150  
## Available:  150 (100%, NA: 0 = 0%)  
## Unique:     2  
##   
## Shortest:   1  
## Longest:    1
## 
## 
## |   |Item | Count| Percent| Cum. Count| Cum. Percent|
## |:--|:----|-----:|-------:|----------:|------------:|
## |1  |F    |   100|  66.67%|        100|       66.67%|
## |2  |M    |    50|  33.33%|        150|      100.00%|</code></pre>
<ul>
<li><p>From this, we can easily make two conclusions: Women are more than men and we have no missing data.</p></li>
<li><p>We need to clean our data before we can start the analysis. Here, we will:</p>
<ul>
<li>Recode the <em>gender</em> column where <strong>M</strong>=<strong>Male</strong> and <strong>F</strong>=<strong>Female</strong></li>
<li>Use the <strong>as.mo()</strong> function to change the data in the <strong>Organism_Name</strong> column from text to micro_organisms</li>
<li>Use the <strong>as.rsi()</strong> function to transform the antibiotics</li>
</ul></li>
<li><p>We will do all this cleaning using the <strong>dplyr</strong> package as seen below:</p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="amr-data-analysis.html#cb17-1"></a>data1&lt;-<span class="st"> </span>data<span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="amr-data-analysis.html#cb17-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender=</span><span class="kw">recode</span>(gender, <span class="st">&quot;M&quot;</span>=<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;F&quot;</span>=<span class="st">&quot;Female&quot;</span>))<span class="op">%&gt;%</span><span class="st"> </span><span class="co"># recode M and F</span></span>
<span id="cb17-3"><a href="amr-data-analysis.html#cb17-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Organism_Name=</span><span class="kw">as.mo</span>(Organism_Name))<span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Transform input to a microorganism ID</span></span>
<span id="cb17-4"><a href="amr-data-analysis.html#cb17-4"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(AMP<span class="op">:</span>GEN),as.mic)<span class="op">%&gt;%</span><span class="co"># Transform input to valid mic levels</span></span>
<span id="cb17-5"><a href="amr-data-analysis.html#cb17-5"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(AMP<span class="op">:</span>GEN), <span class="kw">funs</span>(<span class="kw">as.rsi</span>(.,<span class="dt">guideline=</span><span class="st">&quot;CLSI 2019&quot;</span>))) <span class="co"># interpret MIC values</span></span>
<span id="cb17-6"><a href="amr-data-analysis.html#cb17-6"></a></span>
<span id="cb17-7"><a href="amr-data-analysis.html#cb17-7"></a><span class="kw">head</span>(data1)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   date       ID    gender ward  Organism_Name AMP   AMC   CIP   GEN  
##   &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;mo&gt;          &lt;rsi&gt; &lt;rsi&gt; &lt;rsi&gt; &lt;rsi&gt;
## 1 2010-01-01 V142  Male   A1    B_ESCHR_COLI    R     I     R     S  
## 2 2010-01-02 H89   Female A2    B_ESCHR_COLI    R     I     R     S  
## 3 2010-01-03 I98   Female A3    B_ESCHR_COLI    R     R     R     S  
## 4 2010-01-04 N143  Male   A4    B_ESCHR_COLI    R     I     R     R  
## 5 2010-01-05 F101  Female A5    B_ESCHR_COLI    R     R     R     S  
## 6 2010-01-06 T78   Female A6    B_ESCHR_COLI    R     R     R     S</code></pre>
<ul>
<li>We now apply the EUCAST rules on the antimicrobial results using the <strong>eucast_rules()</strong> function. For example, it will force ampicillin (AMP) to be R if amoxicillin/clavulanic acid is R.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="amr-data-analysis.html#cb19-1"></a>data1 &lt;-<span class="st"> </span><span class="kw">eucast_rules</span>(data1, <span class="dt">col_mo =</span> <span class="st">&quot;Organism_Name&quot;</span>, <span class="dt">rules =</span> <span class="st">&quot;all&quot;</span>)</span></code></pre></div>
<ul>
<li>Since we have the microbial ID, we are able to add some taxonomic properties as shown below</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="amr-data-analysis.html#cb20-1"></a>data1&lt;-<span class="st"> </span>data1<span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="amr-data-analysis.html#cb20-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gramstain=</span><span class="kw">mo_gramstain</span>(Organism_Name))<span class="op">%&gt;%</span><span class="st"> </span><span class="co"># add the gram stain</span></span>
<span id="cb20-3"><a href="amr-data-analysis.html#cb20-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">genus=</span><span class="kw">mo_genus</span>(Organism_Name))<span class="op">%&gt;%</span></span>
<span id="cb20-4"><a href="amr-data-analysis.html#cb20-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">species=</span><span class="kw">mo_species</span>(Organism_Name))</span></code></pre></div>
<div id="first-isolates" class="section level3">
<h3><span class="header-section-number">6.2.1</span> First isolates</h3>
<ul>
<li><p>Analysis of AMR requires that you must only include the first isolate of every patient per episode (e.g. one year) otherwise one can end up getting an overestimate or underestimate of the resistance of an antibiotic, especially in inpatient data. Similarly, this is a requirement in the CLSI.</p></li>
<li><p>To ensure you have included the first isolate, use the <strong>first_isolate()</strong> function from the AMR package. By default, it uses one year per episode and one can change that.</p></li>
</ul>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="amr-data-analysis.html#cb21-1"></a>first_episode &lt;-<span class="st"> </span>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb21-2"><a href="amr-data-analysis.html#cb21-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">first =</span> <span class="kw">first_isolate</span>(<span class="dt">col_date =</span> <span class="st">&quot;date&quot;</span>, <span class="dt">col_patient_id =</span> <span class="st">&quot;ID&quot;</span>))</span></code></pre></div>
<ul>
<li><p>All our isolates are from different patients.</p></li>
<li><p>If we use the inbuilt dataset called <strong>example_isolates</strong> and run the first_isolate column, we can see that only 65% are suitable for resistance analysis. To filter the data on first isolates, we can use the <strong>filter_first_isolate()</strong> function.</p></li>
</ul>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="amr-data-analysis.html#cb22-1"></a>example_isolates1&lt;-example_isolates<span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="amr-data-analysis.html#cb22-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first=</span><span class="kw">first_isolate</span>())<span class="op">%&gt;%</span></span>
<span id="cb22-3"><a href="amr-data-analysis.html#cb22-3"></a><span class="st">  </span><span class="kw">filter_first_isolate</span>()</span></code></pre></div>
<pre><code>## NOTE: Using column &#39;date&#39; as input for `col_date`.</code></pre>
<pre><code>## NOTE: Using column &#39;patient_id&#39; as input for `col_patient_id`.</code></pre>
<ul>
<li>In some instances, you can have some isolates that are of different strains hence should be included in the antibiogram. To ensure you do not exclude isolates, you weight isolates based on their antibiogram using the <strong>key_antibiotics()</strong> function. For example, if there is a column with a name like key_<em>antibiotic_name</em>, the <strong>first_isolate()</strong> function automatically uses it to determine the first weighted isolates.</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="amr-data-analysis.html#cb25-1"></a>weighted_data1&lt;-example_isolates<span class="op">%&gt;%</span></span>
<span id="cb25-2"><a href="amr-data-analysis.html#cb25-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">keyab =</span> <span class="kw">key_antibiotics</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-3"><a href="amr-data-analysis.html#cb25-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">first_weighted =</span> <span class="kw">first_isolate</span>())<span class="op">%&gt;%</span></span>
<span id="cb25-4"><a href="amr-data-analysis.html#cb25-4"></a><span class="st">  </span><span class="kw">filter_first_weighted_isolate</span>() <span class="co"># for filtering only where the weighted_isolate column is TRUE</span></span></code></pre></div>
<pre><code>## NOTE: Using column &#39;keyab&#39; as input for `col_keyantibiotics`. Use
##       col_keyantibiotics = FALSE to prevent this.</code></pre>
<ul>
<li><p>We can now observe that 69.8% of our data is suitable for resistance analysis.</p></li>
<li><p>Now back to our <em>data1</em> dataset. We can create frequency tables to visualise our genus and species columns earlier created.</p></li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="amr-data-analysis.html#cb27-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">freq</span>(genus, species)</span></code></pre></div>
<pre><code>## 
## 
## **Frequency table**   
## 
## Class:      character  
## Length:     150  
## Available:  150 (100%, NA: 0 = 0%)  
## Unique:     4  
##   
## Shortest:   16  
## Longest:    21
## 
## 
## |   |Item                  | Count| Percent| Cum. Count| Cum. Percent|
## |:--|:---------------------|-----:|-------:|----------:|------------:|
## |1  |Escherichia coli      |    92|  61.33%|         92|       61.33%|
## |2  |Salmonella enterica   |    29|  19.33%|        121|       80.67%|
## |3  |Staphylococcus aureus |    25|  16.67%|        146|       97.33%|
## |4  |Klebsiella pneumoniae |     4|   2.67%|        150|      100.00%|</code></pre>
<ul>
<li>If we want to get a quick visualisation of the number of isolates in the different bug-drug combinations, we use the <strong>bug_drug_combinations()</strong> function</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="amr-data-analysis.html#cb29-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-2"><a href="amr-data-analysis.html#cb29-2"></a><span class="st">  </span><span class="kw">bug_drug_combinations</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-3"><a href="amr-data-analysis.html#cb29-3"></a><span class="st">  </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   mo            ab        S     I     R total
##   &lt;chr&gt;         &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 E. coli       AMP       4    39    42    85
## 2 E. coli       AMC      30    31    10    71
## 3 E. coli       CIP      12     4    70    86
## 4 E. coli       GEN      59    13    14    86
## 5 K. pneumoniae AMP       0     0     4     4
## 6 K. pneumoniae AMC       0     1     0     1</code></pre>
<pre><code>## Use &#39;format()&#39; on this result to get a publishable/printable format.</code></pre>
<ul>
<li>Similarly, we can select columns based on the class of antibiotics they are in</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="amr-data-analysis.html#cb32-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-2"><a href="amr-data-analysis.html#cb32-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(Organism_Name, <span class="kw">fluoroquinolones</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-3"><a href="amr-data-analysis.html#cb32-3"></a><span class="st">  </span><span class="kw">bug_drug_combinations</span>()</span></code></pre></div>
<pre><code>## Selecting fluoroquinolones: column &#39;CIP&#39; (ciprofloxacin)</code></pre>
<pre><code>## # A tibble: 4 x 6
##   mo            ab        S     I     R total
##   &lt;chr&gt;         &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 E. coli       CIP      12     4    70    86
## 2 K. pneumoniae CIP       1     0     1     2
## 3 S. aureus     CIP       0     0     0     0
## 4 S. enterica   CIP       0    26     2    28</code></pre>
<pre><code>## Use &#39;format()&#39; on this result to get a publishable/printable format.</code></pre>
</div>
<div id="resistance-percentages" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Resistance percentages</h3>
<ul>
<li>The <strong>resistance()</strong> and <strong>susceptibility()</strong> functions can be used to calculate the resistance and susceptibility respectively.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="amr-data-analysis.html#cb36-1"></a>data1<span class="op">%&gt;%</span></span>
<span id="cb36-2"><a href="amr-data-analysis.html#cb36-2"></a><span class="st">  </span><span class="kw">resistance</span>(AMC)</span></code></pre></div>
<pre><code>## [1] 0.1</code></pre>
<ul>
<li>Similarly, if you want to calculate resistance based on the ward, you may first group the data and use the <strong>summarise()</strong> function.</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="amr-data-analysis.html#cb38-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-2"><a href="amr-data-analysis.html#cb38-2"></a><span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb38-3"><a href="amr-data-analysis.html#cb38-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">ampicillin =</span> <span class="kw">resistance</span>(AMP))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   gender ampicillin
##   &lt;chr&gt;       &lt;dbl&gt;
## 1 Female      0.405
## 2 Male        0.5</code></pre>
<ul>
<li>To be able to count the number of isolates with every group, you use the <strong>n_rsi()</strong> function</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="amr-data-analysis.html#cb40-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-2"><a href="amr-data-analysis.html#cb40-2"></a><span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-3"><a href="amr-data-analysis.html#cb40-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">ampicillin =</span> <span class="kw">resistance</span>(AMP),</span>
<span id="cb40-4"><a href="amr-data-analysis.html#cb40-4"></a>            <span class="dt">available =</span> <span class="kw">n_rsi</span>(AMP))</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   gender ampicillin available
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;int&gt;
## 1 Female      0.405        79
## 2 Male        0.5          38</code></pre>
<ul>
<li>We can also get the proportion of multiple antibiotics so as to calculate empiric susceptibility of combination therapies in an easier way:</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="amr-data-analysis.html#cb42-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb42-2"><a href="amr-data-analysis.html#cb42-2"></a><span class="st">  </span><span class="kw">group_by</span>(genus) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb42-3"><a href="amr-data-analysis.html#cb42-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">amoxicillin =</span> <span class="kw">susceptibility</span>(AMC),</span>
<span id="cb42-4"><a href="amr-data-analysis.html#cb42-4"></a>            <span class="dt">gentamicin =</span> <span class="kw">susceptibility</span>(GEN),</span>
<span id="cb42-5"><a href="amr-data-analysis.html#cb42-5"></a>            <span class="dt">amoxiclav_genta =</span> <span class="kw">susceptibility</span>(AMC, GEN))</span></code></pre></div>
<pre><code>## Warning: Introducing NA: only 1 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 28 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 0 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 2 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 29 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 25 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 2 results available for AMC, GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 28 results available for AMC, GEN (`minimum` =
## 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 25 results available for AMC, GEN (`minimum` =
## 30).</code></pre>
<pre><code>## # A tibble: 4 x 4
##   genus          amoxicillin gentamicin amoxiclav_genta
##   &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt;           &lt;dbl&gt;
## 1 Escherichia          0.859      0.837           0.965
## 2 Klebsiella          NA         NA              NA    
## 3 Salmonella          NA         NA              NA    
## 4 Staphylococcus      NA         NA              NA</code></pre>
<ul>
<li><p>From the CLSI guidelines, a minimum of 30 isolates are required to calculate susceptibility. For genus that have less than 30 isolates, susceptibility is not calculayed.</p></li>
<li><p>Finally, we can be able to visualise our data</p></li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="amr-data-analysis.html#cb53-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-2"><a href="amr-data-analysis.html#cb53-2"></a><span class="st">  </span><span class="kw">group_by</span>(genus) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-3"><a href="amr-data-analysis.html#cb53-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="st">&quot;1. Amoxi/clav&quot;</span> =<span class="st"> </span><span class="kw">susceptibility</span>(AMC),</span>
<span id="cb53-4"><a href="amr-data-analysis.html#cb53-4"></a>            <span class="st">&quot;2. Gentamicin&quot;</span> =<span class="st"> </span><span class="kw">susceptibility</span>(GEN),</span>
<span id="cb53-5"><a href="amr-data-analysis.html#cb53-5"></a>            <span class="st">&quot;3. Amoxi/clav + genta&quot;</span> =<span class="st"> </span><span class="kw">susceptibility</span>(AMC, GEN)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-6"><a href="amr-data-analysis.html#cb53-6"></a><span class="st">  </span><span class="co"># pivot_longer() from the tidyr package transforms the data by &quot;lengthening&quot; it:</span></span>
<span id="cb53-7"><a href="amr-data-analysis.html#cb53-7"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="op">-</span>genus, <span class="dt">names_to =</span> <span class="st">&quot;antibiotic&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb53-8"><a href="amr-data-analysis.html#cb53-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> genus,</span>
<span id="cb53-9"><a href="amr-data-analysis.html#cb53-9"></a>             <span class="dt">y =</span> value,</span>
<span id="cb53-10"><a href="amr-data-analysis.html#cb53-10"></a>             <span class="dt">fill =</span> antibiotic)) <span class="op">+</span></span>
<span id="cb53-11"><a href="amr-data-analysis.html#cb53-11"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge2&quot;</span>)<span class="op">+</span><span class="kw">theme_bw</span>()<span class="op">+</span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Genus&quot;</span>, <span class="dt">y=</span><span class="st">&quot;Susceptibility&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;Antibiotic&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Introducing NA: only 1 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 28 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 0 results available for AMC (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 2 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 29 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 25 results available for GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 2 results available for AMC, GEN (`minimum` = 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 28 results available for AMC, GEN (`minimum` =
## 30).</code></pre>
<pre><code>## Warning: Introducing NA: only 25 results available for AMC, GEN (`minimum` =
## 30).</code></pre>
<pre><code>## Warning: Removed 9 rows containing missing values (geom_col).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-21-1.png" width="672" />
- Similarly, we can use the <strong>geom_rsi()</strong> function which transforms data by calculating the proportions then plotting the data in stacked bars as shown below:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="amr-data-analysis.html#cb64-1"></a><span class="kw">ggplot</span>(data1) <span class="op">+</span></span>
<span id="cb64-2"><a href="amr-data-analysis.html#cb64-2"></a><span class="st">  </span><span class="kw">geom_rsi</span>(<span class="dt">translate_ab =</span> <span class="ot">FALSE</span>)<span class="op">+</span><span class="kw">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<ul>
<li>To have the antibiotic codes converted to the official WHO names, omit the <strong>translate_ab=FALSE</strong></li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="amr-data-analysis.html#cb65-1"></a>data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb65-2"><a href="amr-data-analysis.html#cb65-2"></a><span class="st">  </span><span class="kw">group_by</span>(genus) <span class="op">%&gt;%</span></span>
<span id="cb65-3"><a href="amr-data-analysis.html#cb65-3"></a><span class="st">  </span><span class="kw">ggplot_rsi</span>(<span class="dt">x =</span> <span class="st">&quot;genus&quot;</span>,</span>
<span id="cb65-4"><a href="amr-data-analysis.html#cb65-4"></a>             <span class="dt">facet =</span> <span class="st">&quot;antibiotic&quot;</span>,</span>
<span id="cb65-5"><a href="amr-data-analysis.html#cb65-5"></a>             <span class="dt">breaks =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="dv">25</span>,</span>
<span id="cb65-6"><a href="amr-data-analysis.html#cb65-6"></a>             <span class="dt">datalabels =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb65-7"><a href="amr-data-analysis.html#cb65-7"></a><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span><span class="kw">theme_bw</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 18 rows containing missing values (position_stack).</code></pre>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="independence-test" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Independence test</h3>
<ul>
<li>We can compare resistance of antibiotics of different groups. For example, we can compare amoxicillin resistance for two different hospitals</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="amr-data-analysis.html#cb67-1"></a>check_AMX &lt;-<span class="st"> </span>example_isolates <span class="op">%&gt;%</span></span>
<span id="cb67-2"><a href="amr-data-analysis.html#cb67-2"></a><span class="st">  </span><span class="kw">filter</span>(hospital_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;D&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># filter on only hospitals A and D</span></span>
<span id="cb67-3"><a href="amr-data-analysis.html#cb67-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(hospital_id, AMX) <span class="op">%&gt;%</span><span class="st">             </span><span class="co"># select the hospitals and amoxicillin</span></span>
<span id="cb67-4"><a href="amr-data-analysis.html#cb67-4"></a><span class="st">  </span><span class="kw">group_by</span>(hospital_id) <span class="op">%&gt;%</span><span class="st">                </span><span class="co"># group on the hospitals</span></span>
<span id="cb67-5"><a href="amr-data-analysis.html#cb67-5"></a><span class="st">  </span><span class="kw">count_df</span>(<span class="dt">combine_SI =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># count all isolates per group (hospital_id)</span></span>
<span id="cb67-6"><a href="amr-data-analysis.html#cb67-6"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> hospital_id,    <span class="co"># transform output so A and D are columns</span></span>
<span id="cb67-7"><a href="amr-data-analysis.html#cb67-7"></a>              <span class="dt">values_from =</span> value) <span class="op">%&gt;%</span><span class="st">     </span></span>
<span id="cb67-8"><a href="amr-data-analysis.html#cb67-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(A, D) <span class="op">%&gt;%</span><span class="st">                         </span><span class="co"># and only select these columns</span></span>
<span id="cb67-9"><a href="amr-data-analysis.html#cb67-9"></a><span class="st">  </span><span class="kw">as.matrix</span>()                              <span class="co"># transform to a good old matrix for fisher.test()</span></span>
<span id="cb67-10"><a href="amr-data-analysis.html#cb67-10"></a></span>
<span id="cb67-11"><a href="amr-data-analysis.html#cb67-11"></a>check_AMX</span></code></pre></div>
<pre><code>##        A   D
## [1,]  70 241
## [2,] 108 315</code></pre>
<ul>
<li>We now apply the chi.square test</li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="amr-data-analysis.html#cb69-1"></a><span class="kw">fisher.test</span>(check_AMX)</span></code></pre></div>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  check_AMX
## p-value = 0.3837
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##  0.5903086 1.2114286
## sample estimates:
## odds ratio 
##  0.8473559</code></pre>
<ul>
<li>We can observe that amoxicillin resistance found in isolates from patients in hospital A and D are really not statistically significant.
## Animal Health sector AMR data</li>
</ul>
<p>-This data is mainly collected using the KABS collection tool</p>
</div>
</div>
<div id="animal-health-sector-amuc-data" class="section level2">
<h2><span class="header-section-number">6.3</span> Animal Health Sector AMU/C data</h2>
<p>-This data is mainly collected using the KABS collection tool</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-visualisation.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-AMRdataAnalysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
